# 아키텍처 설계

## 1. 전체 구조 요약
- gRPC 기반 마이크로 서비스 구조
- DID 생성/등록/해결과 VC/VP 발급/검증의 역할 분리
- 교육용 데모 클라이언트가 전체 시나리오를 자동 실행

## 2. 주요 컴포넌트
### 2.1 DID-Registry (apps/did-registry)
- DID Document 저장소 역할
- 내부 저장소: LevelDB
- Store 인터페이스로 스토리지 추상화

### 2.2 DID-Registrar (apps/did-registrar)
- DID method 기반 라우팅/Resolver
- driver 패키지와 연동하여 by50/eth/test 메서드 지원

### 2.3 demo-issuer (apps/demo-issuer)
- VC 발급 기관 역할
- eID, eDL, 렌트카 계약 VC 발급 시나리오 포함

### 2.4 demo-rp (apps/demo-rp)
- Relying Party 역할
- 챌린지/리스폰스 인증, VP 검증

### 2.5 demo-client (apps/demo-client)
- 사용자 역할
- DID 발급, VC 요청, VP 제출 시나리오 수행

### 2.6 did_service_endpoint (apps/did_service_endpoint)
- REST 테스트 엔드포인트 제공
- Swagger 기반 문서화

### 2.7 KMS (pkg/did/kms)
- 키 생성/서명/복호화 제공
- 내부 KMS로 한정(분산 KMS 범위 아님)

## 3. 데이터 흐름
### 3.1 DID 생성/해결
1) demo-client가 DID-Registrar에 CreateDID 요청
2) DID-Registrar가 driver를 통해 DID 생성
3) DID-Registry에 DID Document 저장
4) ResolveDID 요청 시 Registry에서 DID Document 반환

### 3.2 VC 발급
1) demo-client가 issuer에 VC 발급 요청
2) issuer가 VC 생성 후 서명
3) demo-client가 VC 수신

### 3.3 VP 제출/검증
1) demo-client가 VC를 VP로 감싸 RP에 제출
2) demo-rp가 VP 서명/클레임 검증

### 3.4 챌린지 인증
1) demo-client가 RP에 인증 요청
2) RP가 챌린지 발급
3) demo-client가 응답 생성
4) RP가 응답 검증 후 결과 반환

## 4. 구성/배포
- 로컬 실행: `make dev-up`
- 서비스 순서: DID-Registry → DID-Registrar → demo-issuer → demo-rp → demo-client
- 로그: `.devlogs/*.log`

## 5. 보안/키 관리
- .env에 ETH_PRIVATE_KEY_HEX 저장(교육 목적)
- KMS는 키 생성/서명/복호화 제공
- 실서비스 적용 시 키 보관/권한 모델 강화 필요

## 6. 외부 의존성
- gRPC (proto-files)
- LevelDB
- Ethereum 테스트넷 연결(eth driver)
- Swagger/Redocly 문서화

## 7. 디렉터리 구조
- apps/: 서비스 실행 파일
- pkg/: 핵심 라이브러리(VC/VP, DID, KMS 등)
- configs/: 서비스 설정
- docs/: 문서
- proto-files/: gRPC 스키마
